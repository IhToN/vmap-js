"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}var VMAPAdSource=function e(t){for(var a in _classCallCheck(this,e),this.id=t.getAttribute("id"),this.allowMultipleAds=t.getAttribute("allowMultipleAds"),this.followRedirects=t.getAttribute("followRedirects"),this.vastAdData=null,this.adTagURI=null,this.customData=null,t.childNodes){var r=t.childNodes[a];switch(r.localName){case"AdTagURI":this.adTagURI={templateType:r.getAttribute("templateType"),uri:(r.textContent||r.text||"").trim()};break;case"VASTAdData":for(this.vastAdData=r.firstChild;this.vastAdData&&1!==this.vastAdData.nodeType;)this.vastAdData=this.vastAdData.nextSibling;break;case"CustomAdData":this.customData=r}}};function childrenByName(e,t){var a,r=[];for(a in e.childNodes){var n=e.childNodes[a];n.nodeName!==t&&t!=="vmap:".concat(n.nodeName)&&n.nodeName!=="vmap:".concat(t)||r.push(n)}return r}function parseNodeValue(e){if(!e||!e.childNodes)return{};var t,a=e.childNodes,r=[];for(t in a){var n=a[t];"#cdata-section"===n.nodeName&&r.push(n)}if(r&&0<r.length)try{return JSON.parse(r[0].data)}catch(e){}var i,s="";for(i in a){var o=a[i];switch(o.nodeName){case"#text":s+=o.textContent.trim();break;case"#cdata-section":s+=o.data}}return s}function parseXMLNode(e){var t={attributes:{},children:{},value:{}};t.value=parseNodeValue(e);var a=e.attributes;if(a)for(var r in a){var n=a[r];n.nodeName&&void 0!==n.nodeValue&&null!==n.nodeValue&&(t.attributes[n.nodeName]=n.nodeValue)}var i=e.childNodes;if(i)for(var s in i){var o=i[s];o.nodeName&&"#"!==o.nodeName.substring(0,1)&&(t.children[o.nodeName]=parseXMLNode(o))}return t}var VMAPAdBreak=function(){function i(e){for(var t in _classCallCheck(this,i),this.timeOffset=e.getAttribute("timeOffset"),this.breakType=e.getAttribute("breakType"),this.breakId=e.getAttribute("breakId"),this.repeatAfter=e.getAttribute("repeatAfter"),this.adSource=null,this.trackingEvents=[],this.extensions=[],e.childNodes){var a=e.childNodes[t];switch(a.localName){case"AdSource":this.adSource=new VMAPAdSource(a);break;case"TrackingEvents":for(var r in a.childNodes){var n=a.childNodes[r];"Tracking"===n.localName&&this.trackingEvents.push({event:n.getAttribute("event"),uri:(n.textContent||n.text||"").trim()})}break;case"Extensions":this.extensions=childrenByName(a,"Extension").map(function(e){return parseXMLNode(e)})}}}return _createClass(i,[{key:"track",value:function(e,t){for(var a in this.trackingEvents){var r,n=this.trackingEvents[a];n.event===e&&(r=n.uri,"error"===n.event&&(r=r.replace("[ERRORCODE]",t)),this.tracker(r))}}},{key:"tracker",value:function(e){"undefined"!=typeof window&&null!==window&&((new Image).src=e)}}]),i}(),VMAP=function e(t){if(_classCallCheck(this,e),!t||!t.documentElement||"VMAP"!==t.documentElement.localName)throw new Error("Not a VMAP document");for(var a in this.version=t.documentElement.getAttribute("version"),this.adBreaks=[],this.extensions=[],t.documentElement.childNodes){var r=t.documentElement.childNodes[a];switch(r.localName){case"AdBreak":this.adBreaks.push(new VMAPAdBreak(r));break;case"Extensions":this.extensions=childrenByName(r,"Extension").map(function(e){return parseXMLNode(e)})}}};module.exports=VMAP;
